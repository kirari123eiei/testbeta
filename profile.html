<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à</title>

<link rel="stylesheet" href="https://cdn.lineicons.com/4.0/lineicons.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@100..700&family=Athiti:wght@600&family=Kanit&family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">


<style>
body {
  margin: 0;
  background: #0f1220;
  color: #fff;
  font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}

body:lang(th) {
  font-family: "Noto Sans Thai", sans-serif;
}

/* ===== HEADER ===== */
.header{
  background:#111827;
  padding:16px;
  border-bottom:1px solid #333;
}
.header-content{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.header-title {
  margin-left: 25px;
}
.header {
    background: rgba(20, 20, 30, 0.95);
    padding: 20px;
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 0;
}

.header p {
  margin: 0;
  padding-left: 25px;
  color: rgb(211, 211, 211);
}

.user-info {
  display: flex;
  align-items: center;
  gap: 20px;
}

.user-email {
  color: #888;
}

.logout-btn {
    padding: 12px 18px;
    background: #dc2626;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
}

.logout-btn:hover {
  background: #b91c1c;
}

.back-btn {
  font-size: 14px;
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  background: #667eea;
  color: white;
  cursor: pointer;
  transition: background 0.3s;
  text-decoration: none;
  display: inline-block;
}

.back-btn:hover {
  background: #5568d3;
}

/* ===== CONTAINER ===== */
.container {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
}

.card {
  background: #15172a;
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 24px;
}

.card-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 12px;
}

/* ===== PROFILE AVATAR ===== */
.profile-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding-bottom: 24px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  margin-bottom: 32px;
}

.avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: 700;
  color: white;
}

.profile-email {
  font-size: 18px;
  color: #888;
}

/* ===== FORM ===== */
.form-group {
  margin-bottom: 24px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  color: #9ca3af;
  font-size: 14px;
  font-weight: 500;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  background: #1a1a2e;
  border: 1px solid #333;
  border-radius: 8px;
  color: white;
  font-size: 16px;
  box-sizing: border-box;
}

.form-input:focus {
  outline: none;
  border-color: #667eea;
}

.form-input:disabled {
  background: #0f1220;
  color: #666;
  cursor: not-allowed;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

/* ===== BUTTONS ===== */
.btn-group {
  display: flex;
  gap: 12px;
  margin-top: 32px;
}

.btn {
  flex: 1;
  padding: 14px 24px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
  background: #2a2a3e;
  color: white;
}

.btn-secondary:hover {
  background: #3a3a4e;
}

/* ===== INFO BOX ===== */
.info-box {
  background: rgba(102, 126, 234, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.3);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 24px;
  font-size: 14px;
  color: #9ca3af;
}

/* ===== LOADING ===== */
.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}

.hidden {
  display: none !important;
}

/* ===== EDITABLE INPUT ===== */
.editable-input {
  position: relative;
}

.editable-input .form-input {
  padding-left: 16px;
  padding-right: 44px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏î‡∏¥‡∏ô‡∏™‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ */
}


.edit-btn {
  position: absolute;
  right: 10px;   /* ‚Üê ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏Ç‡∏ß‡∏≤ */
  left: auto;    /* ‚Üê ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≤‡∏¢ */
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  font-size: 18px;
  cursor: pointer;
  opacity: 0.7;
}


.edit-btn i {
  font-size: 18px;
  color: #9ca3af;
  transition: color 0.2s, transform 0.2s;
}

.edit-btn:hover i {
  color: #667eea;
  transform: scale(1.1);
}


</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- Header -->
<header class="header">
  <div class="header-content">
    <h1 class="header-title">An Artificial Intelligence‚ÄìBased Screening System for Respiratory Disease <br> and Heatstroke Risk Using Air Quality Data and Preliminary Symptoms</h1>
    <div class="user-info">
      <a href="index.html" class="back-btn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <button class="logout-btn" onclick="logout()">Log out</button>
    </div>
  </div>
  <p> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡∏•‡∏°‡πÅ‡∏î‡∏î‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå </p>
</header>

<!-- Container -->
<div class="container">
  
  <div id="loadingBox" class="loading">
    <p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  </div>

  <div id="profileCard" class="card hidden">
  <div class="profile-header">
    <div class="avatar" id="avatarInitial">U</div>
    <div>
      <div id="DisplayNameHeader"
        style="font-size:24px;font-weight:600;margin-bottom:4px;text-align: center;">
        ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      </div>
      <div class="profile-email" id="userEmailHeader"></div>
    </div>
  </div>

  <h2 class="card-title"> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>

  <div class="info-box">
    <i class="lni lni-key"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
  </div>

  <form>

    <div class="form-group">
      <label class="form-label"> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
      <input type="email" class="form-input" id="emailInput" disabled>
    </div>

    <div class="form-group">
      <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á</label>
      <input type="text" class="form-input" id="DisplayNameInput" disabled>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label"> ‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ ‡πÄ‡∏Å‡∏¥‡∏î</label>
        <input type="date" class="form-input" id="birthdateInput" disabled>
      </div>

      <div class="form-group">
        <label class="form-label"> ‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
        <input type="number" class="form-input" id="ageInput" disabled>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label"> ‡πÄ‡∏û‡∏®</label>
      <select class="form-input" id="genderInput" disabled>
        <option value="">-</option>
        <option value="male">‡∏ä‡∏≤‡∏¢</option>
        <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
      </select>
    </div>


          <div class="form-group">
            <label class="form-label"> ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
            <input 
              type="text" 
              class="form-input" 
              id="chronicDiseaseInput" 
              disabled>
          </div>

          <div class="form-group">
        <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>

        <div class="editable-input">
          <button type="button" class="edit-btn" id="editLocationBtn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
            <i class="lni lni-pencil"></i>
          </button>


          <input
            type="text"
            class="form-input"
            id="locationInput"
            disabled
          />
        </div>
      </div>

      <div class="btn-group hidden" id="locationSubmitBox">
        <button type="button" class="btn btn-primary" id="saveLocationBtn">
          <i class="lni lni-save" style="vertical-align: middle;"></i> 
          Save
        </button>
      </div>
  </form>
</div>

</div>

<script>
const supabaseClient = supabase.createClient(
  "https://zmusdfezopzhrjmmtleo.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InptdXNkZmV6b3B6aHJqbW10bGVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMTI2MTksImV4cCI6MjA4Mzg4ODYxOX0.tzmdjzoYqrBn5Q6tU9d3zLOMFA8qnFX-obYW2HKXWfM"
);

let currentUser = null;

/* ===============================
   ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Login
================================ */
async function checkUser() {
  const { data: { session } } = await supabaseClient.auth.getSession();

  if (!session) {
    window.location.href = "login.html";
    return;
  }

  currentUser = session.user;
  loadProfile();
}

/* ===============================
   ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å personal_info
================================ */
async function loadProfile() {
  const { data, error } = await supabaseClient
    .from('personal_info')
    .select('Display_name, birth, age, gender, place, disease')
    .eq('user_id', currentUser.id)
    .single();

  if (error || !data) {
    console.error('Load profile error:', error);
    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå');
    return;
  }

  /* ===== EMAIL ‡∏à‡∏≤‡∏Å auth ===== */
  document.getElementById('emailInput').value = currentUser.email;
  document.getElementById('userEmailHeader').innerText = currentUser.email;

  /* ===== PERSONAL INFO ===== */
  document.getElementById('DisplayNameInput').value = data.Display_name ?? '';
  document.getElementById('birthdateInput').value = data.birth ?? '';
  document.getElementById('ageInput').value = data.age ?? '';
  document.getElementById('genderInput').value = data.gender ?? '';
  document.getElementById('locationInput').value = data.place ?? '';
  document.getElementById('chronicDiseaseInput').value = data.disease ?? '‡πÑ‡∏°‡πà‡∏°‡∏µ';

  /* ===== HEADER ===== */
  const name = data.Display_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
  document.getElementById('DisplayNameHeader').innerText = name;
  document.getElementById('avatarInitial').innerText =
    name.charAt(0).toUpperCase();

  /* ===== SHOW UI ===== */
  document.getElementById('loadingBox').classList.add('hidden');
  document.getElementById('profileCard').classList.remove('hidden');
}

/* ===============================
   Logout
================================ */
async function logout() {
  await supabaseClient.auth.signOut();
  window.location.href = "login.html";
}



const editBtn = document.getElementById('editLocationBtn');
const locationInput = document.getElementById('locationInput');
const submitBox = document.getElementById('locationSubmitBox');
const saveBtn = document.getElementById('saveLocationBtn');

/* ===== ‡∏Å‡∏î‡∏î‡∏¥‡∏ô‡∏™‡∏≠ ===== */
editBtn.addEventListener('click', () => {
  locationInput.disabled = false;
  locationInput.focus();
  submitBox.classList.remove('hidden');
});

/* ===== ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ===== */
saveBtn.addEventListener('click', async (e) => {
  e.preventDefault(); // üî• ‡∏Å‡∏±‡∏ô form submit

  if (!currentUser) return;

  const newLocation = locationInput.value.trim();
  if (!newLocation) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà');
    return;
  }

  const { error } = await supabaseClient
    .from('personal_info')
    .update({ place: newLocation })
    .eq('user_id', currentUser.id);

  if (error) {
    console.error(error);
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    return;
  }

  alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  locationInput.disabled = true;
  submitBox.classList.add('hidden');
});



/* ===============================
   Start
================================ */
checkUser();
</script>
</body>
</html>